(function(){var a,b=function(h,g){for(var f in h){if(h.hasOwnProperty(f)){g[f]=h[f]}}return g},c=function(g,h){var f=g.element.querySelectorAll('input[name="'+(typeof h!=="undefined"?h+"_":"")+g.options.paramName+'"]');if(typeof f!="undefined"){return f[0]}return"undefined"},d=function(f,g){if(typeof g=="undefined"){return false}f.previewElement.setAttribute("onclick",g);f.previewElement.className=""+f.previewElement.className+" has-info"},e={init:function(){this.on("thumbnail",function(i,k){if(i.width<this.options.minImageWidth||i.height<this.options.minImageHeight){if(typeof i.rejectDimensions==="function"){i.rejectDimensions()}}else{if(typeof i.acceptDimensions==="function"){i.acceptDimensions()}}}).on("removedfile",function(o){if(o.accepted){var l=c(this,"uploaded"),k=c(this,"deleted"),n=c(this);if(typeof l!=="undefined"&&typeof o.uuid!="undefined"){var p=JSON.parse(l.value);l.value=JSON.stringify(HASTE_PLUS.removeFromArray(o.uuid,p))}if(typeof n!=="undefined"&&typeof o.uuid!="undefined"){var i=JSON.parse(n.value);n.value=JSON.stringify(HASTE_PLUS.removeFromArray(o.uuid,i))}if(typeof k!=="undefined"&&typeof o.uuid!="undefined"){var m=JSON.parse(k.value);m.push(o.uuid);k.value=JSON.stringify(m)}}}).on("success",function(p,m){m=m.result.data;if(m.result=="undefined"){return false}var l=c(this,"uploaded"),n=c(this);if(m instanceof Array){for(var o=0,k=m.length;o<k;o++){if((objHandler=q(p,m[o]))!==false){p=objHandler;r(p,l,n);if(p.url){g.createThumbnailFromUrl(p,p.url)}d(p,p.info);break}}}else{if((objHandler=q(p,m))!==false){p=objHandler;r(p,l,n);if(p.url){g.createThumbnailFromUrl(p,p.url)}d(p,p.info)}}function r(u,s,t){if(typeof s!="undefined"){try{var w=JSON.parse(s.value)}catch(v){return false}w.push(u.uuid);s.value=JSON.stringify(w)}if(typeof t!="undefined"){try{var i=JSON.parse(t.value)}catch(v){return false}i.push(u.uuid);t.value=JSON.stringify(i)}}function q(s,i){if(i.error){s.previewElement.classList.remove("dz-success");s.previewElement.classList.add("dz-error");var t=s.previewElement.querySelectorAll(".dz-error-message")[0];t.innerText=i.error;return false}if(i.filenameOrig==s.name&&i.uuid!="undefined"){s.serverFileName=i.filename;s.uuid=i.uuid;s.url=i.url;s.info=i.info;return s}return false}}).on("sending",function(o,r,q){var p=c(this).form;q.append("action",this.options.uploadAction);q.append("requestToken",this.options.requestToken);q.append("FORM_SUBMIT",p.id);q.append("field",this.options.paramName);var l=p.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])");for(var n=0,k=l.length;n<k;n++){var m=l[n];q.append(m.name,m.value)}});var j=c(this,"formattedInitial").value,g=this;if(typeof j!=="undefined"&&j!=""){mocks=JSON.parse(j);for(var h=0;h<mocks.length;h++){var f=mocks[h];f.accepted=true;this.files.push(f);this.emit("addedfile",f);if(f.url){this.createThumbnailFromUrl(f,f.url)}d(f,f.info);this.emit("complete",f)}}}};a={init:function(){Dropzone.autoDiscover=false;this.registerFields()},registerFields:function(){var g=document.getElementsByClassName("multifileupload");for(var j=0,f=g.length;j<f;j++){var k=g[j];if(typeof k.dropzone!="undefined"){continue}data=k.dataset;var h=b(data,e);h.url=history.state!=null?history.state.url:location.href;if(h.uploadActionParams){h.url=h.url+"?"+h.uploadActionParams}new Dropzone(k,h)}}};if(window.jQuery){jQuery(document).ready(function(){a.init()});jQuery(document).ajaxComplete(function(){a.init()})}if(window.MooTools){window.addEvent("domready",function(){a.init()});window.addEvent("ajax_change",function(){a.init()})}}).call(this);