(function(){var b,h=function(i){i=(i+"");return encodeURIComponent(i).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},d=function(l,k){for(var j in l){if(l.hasOwnProperty(j)){k[j]=l[j]}}return k},e=function(j,k){var i=j.element.querySelectorAll('input[name="'+(typeof k!=="undefined"?k+"_":"")+j.options.paramName+'"]');if(typeof i!="undefined"){return i[0]}return"undefined"},f=function(i,j){if(typeof j=="undefined"){return false}i.previewElement.setAttribute("onclick",j);i.previewElement.className=""+i.previewElement.className+" has-info"},a=function(i){return i.replace(/[\-_](\w)/g,function(j){return j.charAt(1).toUpperCase()})},c=function(i,k){if(k){if(k=="this.form.submit()"){document.createElement("form").submit.call(e(i).form);return}var j=Function(k);j()}},g={init:function(){this.on("thumbnail",function(i,n){if(i.width<this.options.minImageWidth||i.height<this.options.minImageHeight){if(typeof i.rejectDimensions==="function"){i.rejectDimensions()}}else{if(typeof i.acceptDimensions==="function"){i.acceptDimensions()}}}).on("removedfile",function(r){if(r.accepted){var o=e(this,"uploaded"),n=e(this,"deleted"),q=e(this);if(typeof o!=="undefined"&&typeof r.uuid!="undefined"){var s=JSON.parse(o.value);o.value=JSON.stringify(HASTE_PLUS.removeFromArray(r.uuid,s))}if(typeof q!=="undefined"&&typeof r.uuid!="undefined"){var i=JSON.parse(q.value);q.value=JSON.stringify(HASTE_PLUS.removeFromArray(r.uuid,i))}if(typeof n!=="undefined"&&typeof r.uuid!="undefined"){var p=JSON.parse(n.value);p.push(r.uuid);n.value=JSON.stringify(p)}if(this.files.length<1){this.element.classList.remove("dz-has-files")}if(this.options.maxFiles!=1){c(this,this.options.onchange)}}}).on("success",function(s,p){if(typeof p.result=="undefined"){k.emit("error",s,k.options.dictResponseError.replace("{{statusCode}}",": Empty response"),p);return}k.options.url=HASTE_PLUS.addParameterToUri(k.options.url,"ato",p.token);p=p.result.data;if(p.result=="undefined"){return false}var o=e(this,"uploaded"),q=e(this);if(p instanceof Array){for(var r=0,n=p.length;r<n;r++){if((objHandler=t(s,p[r]))!==false){s=objHandler;u(s,o,q);if(s.dataURL){k.emit("thumbnail",s,s.dataURL)}f(s,s.info);break}}}else{if((objHandler=t(s,p))!==false){s=objHandler;u(s,o,q);if(s.dataURL){k.emit("thumbnail",s,s.dataURL)}f(s,s.info)}}c(k,k.options.onchange);function u(x,v,w){if(typeof v!="undefined"){try{var z=JSON.parse(v.value)}catch(y){return false}z.push(x.uuid);v.value=JSON.stringify(z)}if(typeof w!="undefined"){try{var i=JSON.parse(w.value)}catch(y){return false}i.push(x.uuid);w.value=JSON.stringify(i)}}function t(v,i){if(i.error){k.emit("error",v,i.error,i);return false}if(i.filenameOrigEncoded==h(v.name)&&i.uuid!="undefined"){v.serverFileName=i.filename;v.uuid=i.uuid;v.url=i.url;v.info=i.info;v.sanitizedName=i.filenameSanitized;v.previewElement.querySelector("[data-dz-name]").innerHTML=i.filenameSanitized;return v}return false}}).on("error",function(p,r,t){var s=p.previewElement.parentNode.querySelectorAll(".dz-error-show");if(s){for(var o=0,n=s.length;o<n;o++){var q=s[o];q.classList.remove("dz-error-show")}}p.previewElement.classList.remove("dz-success");p.previewElement.classList.add("dz-error-show");p.previewElement.addEventListener("mouseleave",function(){this.classList.remove("dz-error-show")})}).on("sending",function(r,u,t){var s=e(this).form;t.append("action",this.options.uploadAction);t.append("requestToken",this.options.requestToken);t.append("FORM_SUBMIT",s.id);t.append("field",this.options.paramName);var o=s.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])");for(var q=0,n=o.length;q<n;q++){var p=o[q];t.append(p.name,p.value)}}).on("addedfile",function(i){if(this.files.length>0){this.element.classList.add("dz-has-files")}});var m=e(this,"formattedInitial").value,k=this;if(typeof m!=="undefined"&&m!=""){mocks=JSON.parse(m);for(var l=0;l<mocks.length;l++){var j=mocks[l];j.accepted=true;this.files.push(j);this.emit("addedfile",j);if(j.dataURL){this.emit("thumbnail",j,j.dataURL)}f(j,j.info);this.emit("complete",j)}if(this.files.length>0){this.element.classList.add("dz-has-files")}}}};b={init:function(){Dropzone.autoDiscover=false;this.registerFields()},registerFields:function(){var t=document.querySelectorAll(".multifileupload");for(var s=0,u=t.length;s<u;s++){var w=t[s];if(typeof w.dropzone!="undefined"){continue}var q=w.attributes,l=q.length,r=w.dataset;if(typeof r=="undefined"){r={};for(;l--;){if(/^data-.*/.test(q[l].name)){var x=a(q[l].name.replace("data-",""));r[x]=q[l].value}}}function v(j,i,n){return j.split(i).join(n)}var m=["dictFileTooBig","dictResponseError"];for(var p=0;p<m.length;p++){r[m[p]]=v(r[m[p]],"{.{","{{");r[m[p]]=v(r[m[p]],"}.}","}}")}var k=d(r,g);k.url=location.href;if(HASTE_PLUS.isTruthy(history.state)&&HASTE_PLUS.isTruthy(history.state.url)){k.url=history.state.url}if(k.uploadActionParams){var o=HASTE_PLUS.parseQueryString(k.uploadActionParams);k.url=HASTE_PLUS.addParametersToUri(k.url,o)}new Dropzone(w,k)}}};if(window.jQuery){jQuery(document).ready(function(){b.init()});jQuery(document).ajaxComplete(function(){b.init()})}if(window.MooTools){window.addEvent("domready",function(){b.init()});window.addEvent("ajax_change",function(){b.init()})}}).call(this);