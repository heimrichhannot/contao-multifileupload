(function(){var b,d=function(k,j){for(var h in k){if(k.hasOwnProperty(h)){j[h]=k[h]}}return j},e=function(i,j){var h=i.element.querySelectorAll('input[name="'+(typeof j!=="undefined"?j+"_":"")+i.options.paramName+'"]');if(typeof h!="undefined"){return h[0]}return"undefined"},f=function(h,i){if(typeof i=="undefined"){return false}h.previewElement.setAttribute("onclick",i);h.previewElement.className=""+h.previewElement.className+" has-info"},a=function(h){return h.replace(/[\-_](\w)/g,function(i){return i.charAt(1).toUpperCase()})},c=function(h,j){if(j){if(j=="this.form.submit()"){document.createElement("form").submit.call(e(h).form);return}var i=Function(j);i()}},g={init:function(){this.on("thumbnail",function(i,m){if(i.width<this.options.minImageWidth||i.height<this.options.minImageHeight){if(typeof i.rejectDimensions==="function"){i.rejectDimensions()}}else{if(typeof i.acceptDimensions==="function"){i.acceptDimensions()}}}).on("removedfile",function(q){if(q.accepted){var n=e(this,"uploaded"),m=e(this,"deleted"),p=e(this);if(typeof n!=="undefined"&&typeof q.uuid!="undefined"){var r=JSON.parse(n.value);n.value=JSON.stringify(HASTE_PLUS.removeFromArray(q.uuid,r))}if(typeof p!=="undefined"&&typeof q.uuid!="undefined"){var i=JSON.parse(p.value);p.value=JSON.stringify(HASTE_PLUS.removeFromArray(q.uuid,i))}if(typeof m!=="undefined"&&typeof q.uuid!="undefined"){var o=JSON.parse(m.value);o.push(q.uuid);m.value=JSON.stringify(o)}if(this.files.length<1){this.element.classList.remove("dz-has-files")}if(this.options.maxFiles!=1){c(this,this.options.onchange)}}}).on("success",function(r,o){if(typeof o.result=="undefined"){j.emit("error",r,j.options.dictResponseError.replace("{{statusCode}}",": Empty response"),o);return}o=o.result.data;if(o.result=="undefined"){return false}var n=e(this,"uploaded"),p=e(this);if(o instanceof Array){for(var q=0,m=o.length;q<m;q++){if((objHandler=s(r,o[q]))!==false){r=objHandler;t(r,n,p);if(r.url){j.createThumbnailFromUrl(r,r.url)}f(r,r.info);break}}}else{if((objHandler=s(r,o))!==false){r=objHandler;t(r,n,p);if(r.url){j.createThumbnailFromUrl(r,r.url)}f(r,r.info)}}c(j,j.options.onchange);function t(w,u,v){if(typeof u!="undefined"){try{var y=JSON.parse(u.value)}catch(x){return false}y.push(w.uuid);u.value=JSON.stringify(y)}if(typeof v!="undefined"){try{var i=JSON.parse(v.value)}catch(x){return false}i.push(w.uuid);v.value=JSON.stringify(i)}}function s(u,i){if(i.error){j.emit("error",u,i.error,i);return false}if(i.filenameOrig==u.name&&i.uuid!="undefined"){u.serverFileName=i.filename;u.uuid=i.uuid;u.url=i.url;u.info=i.info;return u}return false}}).on("error",function(o,q,s){var r=o.previewElement.parentNode.querySelectorAll(".dz-error-show");if(r){for(var n=0,m=r.length;n<m;n++){var p=r[n];p.classList.remove("dz-error-show")}}o.previewElement.classList.remove("dz-success");o.previewElement.classList.add("dz-error-show");o.previewElement.addEventListener("mouseleave",function(){this.classList.remove("dz-error-show")})}).on("sending",function(q,t,s){var r=e(this).form;s.append("action",this.options.uploadAction);s.append("requestToken",this.options.requestToken);s.append("FORM_SUBMIT",r.id);s.append("field",this.options.paramName);var n=r.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])");for(var p=0,m=n.length;p<m;p++){var o=n[p];s.append(o.name,o.value)}}).on("addedfile",function(i){if(this.files.length>0){this.element.classList.add("dz-has-files")}});var l=e(this,"formattedInitial").value,j=this;if(typeof l!=="undefined"&&l!=""){mocks=JSON.parse(l);for(var k=0;k<mocks.length;k++){var h=mocks[k];h.accepted=true;this.files.push(h);this.emit("addedfile",h);if(h.url){this.createThumbnailFromUrl(h,h.url)}f(h,h.info);this.emit("complete",h)}if(this.files.length>0){this.element.classList.add("dz-has-files")}}}};b={init:function(){Dropzone.autoDiscover=false;this.registerFields()},registerFields:function(){var s=document.querySelectorAll(".multifileupload");for(var r=0,t=s.length;r<t;r++){var v=s[r];if(typeof v.dropzone!="undefined"){continue}var p=v.attributes,k=p.length,q=v.dataset;if(typeof q=="undefined"){q={};for(;k--;){if(/^data-.*/.test(p[k].name)){var w=a(p[k].name.replace("data-",""));q[w]=p[k].value}}}function u(j,i,n){return j.split(i).join(n)}var l=["dictFileTooBig","dictResponseError"];for(var o=0;o<l.length;o++){q[l[o]]=u(q[l[o]],"{.{","{{");q[l[o]]=u(q[l[o]],"}.}","}}")}var h=d(q,g);h.url=location.href;if(HASTE_PLUS.isTruthy(history.state)&&HASTE_PLUS.isTruthy(history.state.url)){h.url=history.state.url}if(h.uploadActionParams){var m=HASTE_PLUS.parseQueryString(h.uploadActionParams);h.url=HASTE_PLUS.addParametersToUri(h.url,m)}new Dropzone(v,h)}}};if(window.jQuery){jQuery(document).ready(function(){b.init()});jQuery(document).ajaxComplete(function(){b.init()})}if(window.MooTools){window.addEvent("domready",function(){b.init()});window.addEvent("ajax_change",function(){b.init()})}}).call(this);