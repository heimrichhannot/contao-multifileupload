(function(){var b,c=function(j,h){for(var g in j){if(j.hasOwnProperty(g)){h[g]=j[g]}}return h},d=function(h,i){var g=h.element.querySelectorAll('input[name="'+(typeof i!=="undefined"?i+"_":"")+h.options.paramName+'"]');if(typeof g!="undefined"){return g[0]}return"undefined"},e=function(g,h){if(typeof h=="undefined"){return false}g.previewElement.setAttribute("onclick",h);g.previewElement.className=""+g.previewElement.className+" has-info"},a=function(g){return g.replace(/[\-_](\w)/g,function(h){return h.charAt(1).toUpperCase()})},f={init:function(){this.on("thumbnail",function(i,l){if(i.width<this.options.minImageWidth||i.height<this.options.minImageHeight){if(typeof i.rejectDimensions==="function"){i.rejectDimensions()}}else{if(typeof i.acceptDimensions==="function"){i.acceptDimensions()}}}).on("removedfile",function(p){if(p.accepted){var m=d(this,"uploaded"),l=d(this,"deleted"),o=d(this);if(typeof m!=="undefined"&&typeof p.uuid!="undefined"){var q=JSON.parse(m.value);m.value=JSON.stringify(HASTE_PLUS.removeFromArray(p.uuid,q))}if(typeof o!=="undefined"&&typeof p.uuid!="undefined"){var i=JSON.parse(o.value);o.value=JSON.stringify(HASTE_PLUS.removeFromArray(p.uuid,i))}if(typeof l!=="undefined"&&typeof p.uuid!="undefined"){var n=JSON.parse(l.value);n.push(p.uuid);l.value=JSON.stringify(n)}if(this.files.length<1){this.element.classList.remove("dz-has-files")}}}).on("success",function(q,n){if(typeof n.result=="undefined"){h.emit("error",q,h.options.dictResponseError.replace("{{statusCode}}",": Empty response"),n);return}n=n.result.data;if(n.result=="undefined"){return false}var m=d(this,"uploaded"),o=d(this);if(n instanceof Array){for(var p=0,l=n.length;p<l;p++){if((objHandler=r(q,n[p]))!==false){q=objHandler;s(q,m,o);if(q.url){h.createThumbnailFromUrl(q,q.url)}e(q,q.info);break}}}else{if((objHandler=r(q,n))!==false){q=objHandler;s(q,m,o);if(q.url){h.createThumbnailFromUrl(q,q.url)}e(q,q.info)}}function s(v,t,u){if(typeof t!="undefined"){try{var x=JSON.parse(t.value)}catch(w){return false}x.push(v.uuid);t.value=JSON.stringify(x)}if(typeof u!="undefined"){try{var i=JSON.parse(u.value)}catch(w){return false}i.push(v.uuid);u.value=JSON.stringify(i)}}function r(t,i){if(i.error){h.emit("error",t,i.error,i);return false}if(i.filenameOrig==t.name&&i.uuid!="undefined"){t.serverFileName=i.filename;t.uuid=i.uuid;t.url=i.url;t.info=i.info;return t}return false}}).on("error",function(n,p,r){var q=n.previewElement.parentNode.querySelectorAll(".dz-error-show");if(q){for(var m=0,l=q.length;m<l;m++){var o=q[m];o.classList.remove("dz-error-show")}}n.previewElement.classList.remove("dz-success");n.previewElement.classList.add("dz-error-show");n.previewElement.addEventListener("mouseleave",function(){this.classList.remove("dz-error-show")})}).on("sending",function(p,s,r){var q=d(this).form;r.append("action",this.options.uploadAction);r.append("requestToken",this.options.requestToken);r.append("FORM_SUBMIT",q.id);r.append("field",this.options.paramName);var m=q.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])");for(var o=0,l=m.length;o<l;o++){var n=m[o];r.append(n.name,n.value)}}).on("addedfile",function(i){if(this.files.length>0){this.element.classList.add("dz-has-files")}});var k=d(this,"formattedInitial").value,h=this;if(typeof k!=="undefined"&&k!=""){mocks=JSON.parse(k);for(var j=0;j<mocks.length;j++){var g=mocks[j];g.accepted=true;this.files.push(g);this.emit("addedfile",g);if(g.url){this.createThumbnailFromUrl(g,g.url)}e(g,g.info);this.emit("complete",g)}if(this.files.length>0){this.element.classList.add("dz-has-files")}}}};b={init:function(){Dropzone.autoDiscover=false;this.registerFields()},registerFields:function(){var h=document.getElementsByClassName("multifileupload");for(var m=0,g=h.length;m<g;m++){var o=h[m];if(typeof o.dropzone!="undefined"){continue}var j=o.attributes,m=j.length,n=o.dataset;if(typeof n=="undefined"){n={};for(;m--;){if(/^data-.*/.test(j[m].name)){var l=a(j[m].name.replace("data-",""));n[l]=j[m].value}}}var k=c(n,f);k.url=history.state!=null?history.state.url:location.href;if(k.uploadActionParams){k.url=k.url;k.url+=(k.url.split("?")[1]?"&":"?")+k.uploadActionParams}new Dropzone(o,k)}}};if(window.jQuery){jQuery(document).ready(function(){b.init()});jQuery(document).ajaxComplete(function(){b.init()})}if(window.MooTools){window.addEvent("domready",function(){b.init()});window.addEvent("ajax_change",function(){b.init()})}}).call(this);
